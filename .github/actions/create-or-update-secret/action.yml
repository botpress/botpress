name: 'Create or Update Secret'
description: 'Creates or updates a secret in the repository'

inputs:
  secret_name:
    description: 'Secret name'
    required: true
  secret_value:
    description: 'Secret value'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Generate a token
      id: generate-token
      uses: actions/create-github-app-token@v2
      with:
        app-id: ${{ vars.CREATE_OR_UPDATE_SECRET_APP_ID }}
        private-key: ${{ secrets.CREATE_OR_UPDATE_SECRET_APP_PRIVATE_KEY }}
    - name: Set secret
      shell: bash
      env:
        GH_TOKEN: ${{ steps.generate-token.outputs.token }}
        SECRET_NAME: ${{ inputs.secret_name }}
        SECRET_VALUE: ${{ inputs.secret_value }}
      run: |
        gh secret set $SECRET_NAME --body "$SECRET_VALUE"
