{
  "name": "hitl",
  "version": "1.0.0",
  "title": "Human In The Loop",
  "description": "Seamlessly transfer conversations to human agents",
  "user": {
    "tags": {
      "downstream": {
        "title": "Downstream User ID",
        "description": "ID of the downstream user bound to the upstream one"
      },
      "upstream": {
        "title": "Upstream User ID",
        "description": "ID of the upstream user bound to the downstream one"
      },
      "integrationName": {
        "title": "HITL Integration Name",
        "description": "Name of the integration which created the downstream user"
      }
    }
  },
  "conversation": {
    "tags": {
      "downstream": {
        "title": "Downstream Conversation ID",
        "description": "ID of the downstream conversation bound to the upstream one"
      },
      "upstream": {
        "title": "Upstream Conversation ID",
        "description": "ID of the upstream conversation bound to the downstream one"
      },
      "humanAgentId": {
        "title": "Human Agent ID",
        "description": "ID of the human agent assigned to the ticket"
      },
      "humanAgentName": {
        "title": "Human Agent Name",
        "description": "Name of the human agent assigned to the ticket"
      },
      "hitlEndReason": {
        "title": "HITL End Reason",
        "description": "Reason why the HITL session ended"
      },
      "startMessageId": {
        "title": "Start Message ID",
        "description": "ID of the user message that initiated the HITL session"
      }
    }
  },
  "configuration": {
    "schema": {
      "type": "object",
      "properties": {
        "onHitlHandoffMessage": {
          "type": "string",
          "description": "The message to send to the user when transferring to a human agent",
          "x-zui": {
            "title": "Escalation Started Message",
            "placeholder": "I have escalated this conversation to a human agent. They should be with you shortly."
          }
        },
        "onHumanAgentAssignedMessage": {
          "type": "string",
          "description": "The message to send to the user when a human agent is assigned",
          "x-zui": {
            "title": "Human Agent Assigned Message",
            "placeholder": "A human agent has joined the conversation."
          }
        },
        "onHitlStoppedMessage": {
          "type": "string",
          "description": "The message to send to the user when the HITL session stops and control is transferred back to bot",
          "x-zui": {
            "title": "Escalation Terminated Message",
            "placeholder": "The human agent closed the conversation. I will continue assisting you."
          }
        },
        "onUserHitlCancelledMessage": {
          "type": "string",
          "description": "The message to send to the human agent when the user abruptly ends the HITL session",
          "x-zui": {
            "title": "Escalation Aborted Message",
            "placeholder": "( The user has ended the session. )"
          }
        },
        "onIncompatibleMsgTypeMessage": {
          "type": "string",
          "description": "The warning to send to the human agent when they send a message that is not supported by the hitl session",
          "x-zui": {
            "title": "Incompatible Message Type Warning",
            "placeholder": "Sorry, the user can not receive this type of message. Please resend your message as a text message."
          }
        },
        "userHitlCloseCommand": {
          "type": "string",
          "description": "Users may send this command to end the HITL session at any time. It is case-insensitive, so it works regardless of letter casing.",
          "x-zui": {
            "title": "Termination Command",
            "placeholder": "/end"
          }
        },
        "onUserHitlCloseMessage": {
          "type": "string",
          "description": "The message to send to the user when they end the HITL session using the termination command",
          "x-zui": {
            "title": "Termination Command Message",
            "placeholder": "You have ended the session with the human agent. I will continue assisting you."
          }
        },
        "onAgentAssignedTimeoutMessage": {
          "type": "string",
          "description": "The message to send to the user when no human agent is assigned within the timeout period",
          "x-zui": {
            "title": "Agent Assigned Timeout Message",
            "placeholder": "No human agent is available at the moment. Please try again later. I will continue assisting you for the time being."
          }
        },
        "agentAssignedTimeoutSeconds": {
          "type": "number",
          "minimum": 0,
          "description": "The time in seconds to wait before giving up and telling the user that no human agent is available. Set to 0 to disable",
          "x-zui": {
            "title": "Agent Assigned Timeout",
            "placeholder": "0"
          }
        },
        "useHumanAgentInfo": {
          "type": "boolean",
          "description": "(Works only with webchat) Enable this to use the human agent name and photo (if available) as the bot name and photo while in HITL mode.",
          "x-zui": {
            "title": "Use Human Agent Info"
          },
          "default": true
        },
        "flowOnHitlStopped": {
          "type": "boolean",
          "description": "Enable this to continue the flow when the HITL session ends. Otherwise, the flow waits for user input.",
          "x-zui": {
            "title": "Continue Flow on Session End?"
          },
          "default": true
        }
      },
      "additionalProperties": false,
      "x-zui": {},
      "$schema": "http://json-schema.org/draft-07/schema#"
    }
  },
  "events": {
    "humanAgentAssignedTimeout": {
      "schema": {
        "type": "object",
        "properties": {
          "sessionStartedAt": {
            "type": "string",
            "description": "Timestamp of when the HITL session started",
            "x-zui": {
              "title": "Session Started At"
            }
          },
          "downstreamConversationId": {
            "type": "string",
            "description": "ID of the downstream conversation",
            "x-zui": {
              "title": "Downstream Conversation ID"
            }
          }
        },
        "required": ["sessionStartedAt", "downstreamConversationId"],
        "additionalProperties": false,
        "x-zui": {},
        "$schema": "http://json-schema.org/draft-07/schema#"
      }
    },
    "continueWorkflow": {
      "schema": {
        "type": "object",
        "properties": {
          "conversationId": {
            "type": "string",
            "description": "ID of the upstream conversation",
            "x-zui": {
              "title": "Upstream Conversation ID"
            }
          }
        },
        "required": ["conversationId"],
        "additionalProperties": false,
        "x-zui": {},
        "$schema": "http://json-schema.org/draft-07/schema#"
      }
    }
  },
  "actions": {
    "startHitl": {
      "title": "Start HITL",
      "description": "Starts the HITL mode",
      "input": {
        "schema": {
          "type": "object",
          "properties": {
            "title": {
              "type": "string",
              "description": "Title of the HITL ticket",
              "x-zui": {
                "title": "Ticket Title"
              }
            },
            "description": {
              "type": "string",
              "description": "Description of the HITL ticket",
              "x-zui": {
                "title": "Ticket Description"
              }
            },
            "hitlSession": {
              "$ref": "interface:hitl/entities/hitlSession",
              "description": "Configuration of the HITL session",
              "x-zui": {
                "title": "Extra configuration"
              }
            },
            "userId": {
              "type": "string",
              "description": "ID of the user that starts the HITL mode",
              "x-zui": {
                "title": "User ID",
                "placeholder": "{{ event.userId }}"
              }
            },
            "userEmail": {
              "type": "string",
              "description": "Email of the user that starts the HITL mode. If this value is unset, the agent will try to use the email provided by the channel.",
              "x-zui": {
                "title": "User Email"
              }
            },
            "conversationId": {
              "type": "string",
              "description": "ID of the conversation on which to start the HITL mode",
              "x-zui": {
                "title": "Conversation ID",
                "placeholder": "{{ event.conversationId }}"
              }
            },
            "configurationOverrides": {
              "type": "object",
              "properties": {
                "onHitlHandoffMessage": {
                  "type": "string",
                  "description": "The message to send to the user when transferring to a human agent",
                  "x-zui": {
                    "title": "Escalation Started Message",
                    "placeholder": "I have escalated this conversation to a human agent. They should be with you shortly."
                  }
                },
                "onHumanAgentAssignedMessage": {
                  "type": "string",
                  "description": "The message to send to the user when a human agent is assigned",
                  "x-zui": {
                    "title": "Human Agent Assigned Message",
                    "placeholder": "A human agent has joined the conversation."
                  }
                },
                "onHitlStoppedMessage": {
                  "type": "string",
                  "description": "The message to send to the user when the HITL session stops and control is transferred back to bot",
                  "x-zui": {
                    "title": "Escalation Terminated Message",
                    "placeholder": "The human agent closed the conversation. I will continue assisting you."
                  }
                },
                "onUserHitlCancelledMessage": {
                  "type": "string",
                  "description": "The message to send to the human agent when the user abruptly ends the HITL session",
                  "x-zui": {
                    "title": "Escalation Aborted Message",
                    "placeholder": "( The user has ended the session. )"
                  }
                },
                "onIncompatibleMsgTypeMessage": {
                  "type": "string",
                  "description": "The warning to send to the human agent when they send a message that is not supported by the hitl session",
                  "x-zui": {
                    "title": "Incompatible Message Type Warning",
                    "placeholder": "Sorry, the user can not receive this type of message. Please resend your message as a text message."
                  }
                },
                "userHitlCloseCommand": {
                  "type": "string",
                  "description": "Users may send this command to end the HITL session at any time. It is case-insensitive, so it works regardless of letter casing.",
                  "x-zui": {
                    "title": "Termination Command",
                    "placeholder": "/end"
                  }
                },
                "onUserHitlCloseMessage": {
                  "type": "string",
                  "description": "The message to send to the user when they end the HITL session using the termination command",
                  "x-zui": {
                    "title": "Termination Command Message",
                    "placeholder": "You have ended the session with the human agent. I will continue assisting you."
                  }
                },
                "onAgentAssignedTimeoutMessage": {
                  "type": "string",
                  "description": "The message to send to the user when no human agent is assigned within the timeout period",
                  "x-zui": {
                    "title": "Agent Assigned Timeout Message",
                    "placeholder": "No human agent is available at the moment. Please try again later. I will continue assisting you for the time being."
                  }
                },
                "agentAssignedTimeoutSeconds": {
                  "type": "number",
                  "minimum": 0,
                  "description": "The time in seconds to wait before giving up and telling the user that no human agent is available. Set to 0 to disable",
                  "x-zui": {
                    "title": "Agent Assigned Timeout",
                    "placeholder": "0"
                  }
                },
                "useHumanAgentInfo": {
                  "type": "boolean",
                  "description": "(Works only with webchat) Enable this to use the human agent name and photo (if available) as the bot name and photo while in HITL mode.",
                  "x-zui": {
                    "title": "Use Human Agent Info"
                  },
                  "default": true
                },
                "flowOnHitlStopped": {
                  "type": "boolean",
                  "description": "Enable this to continue the flow when the HITL session ends. Otherwise, the flow waits for user input.",
                  "x-zui": {
                    "title": "Continue Flow on Session End?"
                  },
                  "default": true
                }
              },
              "additionalProperties": false,
              "description": "Use this to override the global configuration for this specific HITL session",
              "x-zui": {
                "title": "Configuration Overrides"
              }
            }
          },
          "required": ["title", "userId", "conversationId"],
          "additionalProperties": true,
          "x-zui": {},
          "$schema": "http://json-schema.org/draft-07/schema#"
        }
      },
      "output": {
        "schema": {
          "type": "object",
          "properties": {},
          "additionalProperties": false,
          "x-zui": {},
          "$schema": "http://json-schema.org/draft-07/schema#"
        }
      }
    },
    "stopHitl": {
      "title": "Stop HITL",
      "description": "Stop the HITL mode",
      "input": {
        "schema": {
          "type": "object",
          "properties": {
            "conversationId": {
              "type": "string",
              "description": "ID of the conversation on which to stop the HITL mode",
              "x-zui": {
                "placeholder": "{{ event.conversationId }}"
              }
            }
          },
          "required": ["conversationId"],
          "additionalProperties": false,
          "x-zui": {},
          "$schema": "http://json-schema.org/draft-07/schema#"
        }
      },
      "output": {
        "schema": {
          "type": "object",
          "properties": {},
          "additionalProperties": false,
          "x-zui": {},
          "$schema": "http://json-schema.org/draft-07/schema#"
        }
      }
    }
  },
  "states": {
    "hitl": {
      "type": "conversation",
      "schema": {
        "type": "object",
        "properties": {
          "hitlActive": {
            "type": "boolean",
            "description": "Whether the conversation is in HITL mode",
            "x-zui": {
              "title": "Is HITL Enabled?"
            }
          }
        },
        "required": ["hitlActive"],
        "additionalProperties": false,
        "x-zui": {},
        "$schema": "http://json-schema.org/draft-07/schema#"
      }
    },
    "effectiveSessionConfig": {
      "type": "conversation",
      "schema": {
        "type": "object",
        "properties": {
          "onHitlHandoffMessage": {
            "type": "string",
            "description": "The message to send to the user when transferring to a human agent",
            "x-zui": {
              "title": "Escalation Started Message",
              "placeholder": "I have escalated this conversation to a human agent. They should be with you shortly."
            }
          },
          "onHumanAgentAssignedMessage": {
            "type": "string",
            "description": "The message to send to the user when a human agent is assigned",
            "x-zui": {
              "title": "Human Agent Assigned Message",
              "placeholder": "A human agent has joined the conversation."
            }
          },
          "onHitlStoppedMessage": {
            "type": "string",
            "description": "The message to send to the user when the HITL session stops and control is transferred back to bot",
            "x-zui": {
              "title": "Escalation Terminated Message",
              "placeholder": "The human agent closed the conversation. I will continue assisting you."
            }
          },
          "onUserHitlCancelledMessage": {
            "type": "string",
            "description": "The message to send to the human agent when the user abruptly ends the HITL session",
            "x-zui": {
              "title": "Escalation Aborted Message",
              "placeholder": "( The user has ended the session. )"
            }
          },
          "onIncompatibleMsgTypeMessage": {
            "type": "string",
            "description": "The warning to send to the human agent when they send a message that is not supported by the hitl session",
            "x-zui": {
              "title": "Incompatible Message Type Warning",
              "placeholder": "Sorry, the user can not receive this type of message. Please resend your message as a text message."
            }
          },
          "userHitlCloseCommand": {
            "type": "string",
            "description": "Users may send this command to end the HITL session at any time. It is case-insensitive, so it works regardless of letter casing.",
            "x-zui": {
              "title": "Termination Command",
              "placeholder": "/end"
            }
          },
          "onUserHitlCloseMessage": {
            "type": "string",
            "description": "The message to send to the user when they end the HITL session using the termination command",
            "x-zui": {
              "title": "Termination Command Message",
              "placeholder": "You have ended the session with the human agent. I will continue assisting you."
            }
          },
          "onAgentAssignedTimeoutMessage": {
            "type": "string",
            "description": "The message to send to the user when no human agent is assigned within the timeout period",
            "x-zui": {
              "title": "Agent Assigned Timeout Message",
              "placeholder": "No human agent is available at the moment. Please try again later. I will continue assisting you for the time being."
            }
          },
          "agentAssignedTimeoutSeconds": {
            "type": "number",
            "minimum": 0,
            "description": "The time in seconds to wait before giving up and telling the user that no human agent is available. Set to 0 to disable",
            "x-zui": {
              "title": "Agent Assigned Timeout",
              "placeholder": "0"
            }
          },
          "useHumanAgentInfo": {
            "type": "boolean",
            "description": "(Works only with webchat) Enable this to use the human agent name and photo (if available) as the bot name and photo while in HITL mode.",
            "x-zui": {
              "title": "Use Human Agent Info"
            },
            "default": true
          },
          "flowOnHitlStopped": {
            "type": "boolean",
            "description": "Enable this to continue the flow when the HITL session ends. Otherwise, the flow waits for user input.",
            "x-zui": {
              "title": "Continue Flow on Session End?"
            },
            "default": true
          }
        },
        "additionalProperties": false,
        "x-zui": {},
        "$schema": "http://json-schema.org/draft-07/schema#"
      }
    }
  }
}
