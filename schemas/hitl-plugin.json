{
  "name": "hitl",
  "version": "0.4.5",
  "title": "Human In The Loop",
  "description": "Seamlessly transfer conversations to human agents",
  "user": {
    "tags": {
      "downstream": {
        "title": "Downstream User ID",
        "description": "ID of the downstream user binded to the upstream one"
      },
      "upstream": {
        "title": "Upstream User ID",
        "description": "ID of the upstream user binded to the downstream one"
      },
      "integrationName": {
        "title": "HITL Integration Name",
        "description": "Name of the integration which created the downstream user"
      }
    }
  },
  "conversation": {
    "tags": {
      "downstream": {
        "title": "Downstream Conversation ID",
        "description": "ID of the downstream conversation binded to the upstream one"
      },
      "upstream": {
        "title": "Upstream Conversation ID",
        "description": "ID of the upstream conversation binded to the downstream one"
      },
      "humanAgentId": {
        "title": "Human Agent ID",
        "description": "ID of the human agent assigned to the ticket"
      },
      "humanAgentName": {
        "title": "Human Agent Name",
        "description": "Name of the human agent assigned to the ticket"
      },
      "hitlEndReason": {
        "title": "HITL End Reason",
        "description": "Reason why the HITL session ended"
      },
      "startMessageId": {
        "title": "Start Message ID",
        "description": "ID of the user message that initiated the HITL session"
      }
    }
  },
  "configuration": {
    "schema": {
      "type": "object",
      "properties": {
        "onHitlHandoffMessage": {
          "type": "string",
          "description": "The message to send to the user when transferring to a human agent",
          "x-zui": {
            "title": "Escalation Started Message",
            "placeholder": "I have escalated this conversation to a human agent. They should be with you shortly."
          }
        },
        "onHumanAgentAssignedMessage": {
          "type": "string",
          "description": "The message to send to the user when a human agent is assigned",
          "x-zui": {
            "title": "Human Agent Assigned Message",
            "placeholder": "A human agent has joined the conversation."
          }
        },
        "onHitlStoppedMessage": {
          "type": "string",
          "description": "The message to send to the user when the hitl session stops and control is tranfered back to bot",
          "x-zui": {
            "title": "Escalation Terminated Message",
            "placeholder": "The human agent closed the conversation. I will continue assisting you."
          }
        },
        "onUserHitlCancelledMessage": {
          "type": "string",
          "description": "The message to send to the human agent when the user abruptly ends the hitl session",
          "x-zui": {
            "title": "Escalation Aborted Message",
            "placeholder": "( The user has ended the session. )"
          }
        },
        "onIncompatibleMsgTypeMessage": {
          "type": "string",
          "description": "The warning to send to the human agent when they send a message that is not supported by the hitl session",
          "x-zui": {
            "title": "Incompatible Message Type Warning",
            "placeholder": "Sorry, the user can only receive text messages. Please resend your message as a text message."
          }
        },
        "userHitlCloseCommand": {
          "type": "string",
          "description": "Users may send this command to end the hitl session at any time. It is case-insensitive, so it works regardless of letter casing.",
          "x-zui": {
            "title": "Termination Command",
            "placeholder": "/end"
          }
        },
        "onUserHitlCloseMessage": {
          "type": "string",
          "description": "The message to send to the user when they end the hitl session using the termination command",
          "x-zui": {
            "title": "Termination Command Message",
            "placeholder": "You have ended the session with the human agent. I will continue assisting you."
          }
        },
        "onAgentAssignedTimeoutMessage": {
          "type": "string",
          "description": "The message to send to the user when no human agent is assigned within the timeout period",
          "x-zui": {
            "title": "Agent Assigned Timeout Message",
            "placeholder": "No human agent is available at the moment. Please try again later. I will continue assisting you for the time being."
          }
        },
        "agentAssignedTimeoutSeconds": {
          "type": "number",
          "description": "The time in seconds to wait before giving up and telling the user that no human agent is available. Set to 0 to disable",
          "x-zui": {
            "title": "Agent Assigned Timeout",
            "placeholder": "0"
          },
          "minimum": 0
        }
      },
      "required": []
    }
  },
  "events": {
    "humanAgentAssignedTimeout": {
      "schema": {
        "type": "object",
        "properties": {
          "sessionStartedAt": {
            "type": "string",
            "description": "Timestamp of when the HITL session started",
            "x-zui": {
              "title": "Session Started At"
            }
          },
          "downstreamConversationId": {
            "type": "string",
            "description": "ID of the downstream conversation",
            "x-zui": {
              "title": "Downstream Conversation ID"
            }
          }
        },
        "required": [
          "sessionStartedAt",
          "downstreamConversationId"
        ]
      }
    }
  },
  "actions": {
    "startHitl": {
      "title": "Start HITL",
      "description": "Starts the HITL mode",
      "input": {
        "schema": {
          "type": "object",
          "properties": {
            "title": {
              "type": "string",
              "description": "Title of the HITL ticket",
              "x-zui": {
                "title": "Ticket Title"
              }
            },
            "description": {
              "type": "string",
              "x-zui": {
                "title": "Ticket Description"
              }
            },
            "userId": {
              "type": "string",
              "description": "ID of the user that starts the HITL mode",
              "x-zui": {
                "title": "User ID",
                "placeholder": "{{ event.userId }}"
              }
            },
            "userEmail": {
              "type": "string",
              "x-zui": {
                "title": "User Email"
              }
            },
            "conversationId": {
              "type": "string",
              "description": "ID of the conversation on which to start the HITL mode",
              "x-zui": {
                "title": "Conversation ID",
                "placeholder": "{{ event.conversationId }}"
              }
            }
          },
          "required": [
            "title",
            "userId",
            "conversationId"
          ]
        }
      },
      "output": {
        "schema": {
          "type": "object",
          "properties": {},
          "required": []
        }
      }
    },
    "stopHitl": {
      "title": "Stop HITL",
      "description": "Stop the HITL mode",
      "input": {
        "schema": {
          "type": "object",
          "properties": {
            "conversationId": {
              "type": "string",
              "description": "ID of the conversation on which to stop the HITL mode",
              "x-zui": {
                "placeholder": "{{ event.conversationId }}"
              }
            }
          },
          "required": [
            "conversationId"
          ]
        }
      },
      "output": {
        "schema": {
          "type": "object",
          "properties": {},
          "required": []
        }
      }
    }
  },
  "states": {
    "hitl": {
      "type": "conversation",
      "schema": {
        "type": "object",
        "properties": {
          "hitlActive": {
            "type": "boolean",
            "description": "Whether the conversation is in HITL mode",
            "x-zui": {
              "title": "Is HITL Enabled?"
            }
          }
        },
        "required": [
          "hitlActive"
        ]
      }
    }
  }
}
